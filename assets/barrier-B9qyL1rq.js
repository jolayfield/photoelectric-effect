import"./style-CxrePxvY.js";class v{canvas;ctx;width;height;energy=3;barrierHeight=5;barrierWidth=.5;time=0;lastTimestamp=0;regionLeft=0;regionRight=0;barrierLeft=0;barrierRight=0;baseline=0;constructor(t){this.canvas=t;const e=t.getContext("2d");if(!e)throw new Error("2D context not found");this.ctx=e,this.width=t.width,this.height=t.height,this.handleResize(),window.addEventListener("resize",()=>this.handleResize()),this.loop=this.loop.bind(this),requestAnimationFrame(this.loop)}handleResize(){this.canvas.parentElement&&(this.canvas.width=this.canvas.parentElement.clientWidth,this.canvas.height=this.canvas.parentElement.clientHeight,this.width=this.canvas.width,this.height=this.canvas.height,this.updateLayout())}updateLayout(){this.regionLeft=50,this.regionRight=this.width-50;const e=this.regionRight-this.regionLeft,i=Math.max(.05,Math.min(.3,this.barrierWidth/3));this.barrierLeft=this.regionLeft+e*(.5-i/2),this.barrierRight=this.regionLeft+e*(.5+i/2),this.baseline=this.height*.65}getTransmission(){const t=this.energy,e=this.barrierHeight,i=this.barrierWidth;if(Math.abs(t-e)<.01)return 1/(1+i*e*(i*e)*.26);if(t<e){const s=Math.sqrt(e-t)*i*5.12,r=Math.sinh(s);return 1/(1+e*e*r*r/(4*t*(e-t)))}else{const s=Math.sqrt(t-e)*i*5.12,r=Math.sin(s);return 1/(1+e*e*r*r/(4*t*(t-e)))}}getReflection(){return 1-this.getTransmission()}update(t){this.time+=t*.004,this.updateLayout()}draw(){this.ctx.clearRect(0,0,this.width,this.height);const t=this.ctx,e=this.getTransmission(),i=this.getReflection();this.drawPotential(t),this.drawWaves(t,e,i),this.drawLabels(t,e,i)}drawPotential(t){t.beginPath(),t.strokeStyle="#b2bec3",t.lineWidth=1,t.setLineDash([5,5]),t.moveTo(this.regionLeft,this.baseline),t.lineTo(this.regionRight,this.baseline),t.stroke(),t.setLineDash([]);const e=this.height*.45,i=e*Math.min(1,this.barrierHeight/10),s=this.baseline-i,r=t.createLinearGradient(0,s,0,this.baseline);r.addColorStop(0,"rgba(255, 87, 34, 0.35)"),r.addColorStop(1,"rgba(255, 87, 34, 0.08)"),t.fillStyle=r,t.fillRect(this.barrierLeft,s,this.barrierRight-this.barrierLeft,i),t.beginPath(),t.strokeStyle="#ff5722",t.lineWidth=2,t.moveTo(this.barrierLeft,this.baseline),t.lineTo(this.barrierLeft,s),t.lineTo(this.barrierRight,s),t.lineTo(this.barrierRight,this.baseline),t.stroke(),t.fillStyle="#e64a19",t.font="bold 13px Arial",t.textAlign="center",t.fillText(`V₀ = ${this.barrierHeight.toFixed(1)} eV`,(this.barrierLeft+this.barrierRight)/2,s-8);const g=Math.min(1,this.energy/10),b=this.baseline-g*e;t.beginPath(),t.strokeStyle="rgba(61, 90, 254, 0.5)",t.lineWidth=1.5,t.setLineDash([8,4]),t.moveTo(this.regionLeft,b),t.lineTo(this.regionRight,b),t.stroke(),t.setLineDash([]),t.fillStyle="#3d5afe",t.font="12px Arial",t.textAlign="left",t.fillText(`E = ${this.energy.toFixed(1)} eV`,this.regionLeft+5,b-8),t.fillStyle="#636e72",t.font="11px Arial",t.textAlign="center",t.fillText("Region I",(this.regionLeft+this.barrierLeft)/2,this.baseline+25),t.fillText("Region II",(this.barrierLeft+this.barrierRight)/2,this.baseline+25),t.fillText("Region III",(this.barrierRight+this.regionRight)/2,this.baseline+25)}drawWaves(t,e,i){const r=Math.sqrt(this.energy)*3,g=this.energy*2,b=1,u=Math.sqrt(i),p=Math.sqrt(e);t.lineWidth=2.5,t.beginPath(),t.strokeStyle="#00bcd4",t.shadowColor="rgba(0, 188, 212, 0.4)",t.shadowBlur=6;const c=this.barrierLeft-this.regionLeft;for(let o=0;o<=c;o+=1.5){const n=this.regionLeft+o,h=o/c*8,d=b*Math.sin(r*h-g*this.time),f=this.baseline-d*40;o===0?t.moveTo(n,f):t.lineTo(n,f)}if(t.stroke(),t.shadowBlur=0,i>.01){t.beginPath(),t.strokeStyle="rgba(244, 67, 54, 0.8)",t.shadowColor="rgba(244, 67, 54, 0.3)",t.shadowBlur=6;for(let o=0;o<=c;o+=1.5){const n=this.regionLeft+o,h=o/c*8,d=u*Math.sin(-r*h-g*this.time),f=this.baseline-d*40;o===0?t.moveTo(n,f):t.lineTo(n,f)}t.stroke(),t.shadowBlur=0}const l=this.barrierRight-this.barrierLeft;if(this.energy<this.barrierHeight){const o=Math.sqrt(this.barrierHeight-this.energy)*2;t.beginPath(),t.strokeStyle="rgba(255, 152, 0, 0.7)",t.shadowColor="rgba(255, 152, 0, 0.3)",t.shadowBlur=4;for(let n=0;n<=l;n+=1.5){const h=this.barrierLeft+n,d=n/l,m=Math.exp(-o*d*3)*Math.sin(-g*this.time),w=this.baseline-m*40;n===0?t.moveTo(h,w):t.lineTo(h,w)}t.stroke(),t.shadowBlur=0}else{const o=Math.sqrt(this.energy-this.barrierHeight)*3;t.beginPath(),t.strokeStyle="rgba(255, 152, 0, 0.7)",t.shadowColor="rgba(255, 152, 0, 0.3)",t.shadowBlur=4;for(let n=0;n<=l;n+=1.5){const h=this.barrierLeft+n,d=n/l*4,f=Math.sin(o*d-g*this.time),m=this.baseline-f*40;n===0?t.moveTo(h,m):t.lineTo(h,m)}t.stroke(),t.shadowBlur=0}if(e>.001){t.beginPath(),t.strokeStyle="#4caf50",t.shadowColor="rgba(76, 175, 80, 0.4)",t.shadowBlur=6;const o=this.regionRight-this.barrierRight;for(let n=0;n<=o;n+=1.5){const h=this.barrierRight+n,d=n/o*8,f=p*Math.sin(r*d-g*this.time),m=this.baseline-f*40;n===0?t.moveTo(h,m):t.lineTo(h,m)}t.stroke(),t.shadowBlur=0}t.font="11px Arial",t.textAlign="left";const a=this.height-30;t.fillStyle="#00bcd4",t.fillRect(this.regionLeft,a,14,3),t.fillText("Incident",this.regionLeft+18,a+4),t.fillStyle="#f44336",t.fillRect(this.regionLeft+90,a,14,3),t.fillText("Reflected",this.regionLeft+108,a+4),t.fillStyle="#4caf50",t.fillRect(this.regionLeft+190,a,14,3),t.fillText("Transmitted",this.regionLeft+208,a+4),t.fillStyle="#ff9800",t.fillRect(this.regionLeft+310,a,14,3),t.fillText("Inside Barrier",this.regionLeft+328,a+4)}drawLabels(t,e,i){const s=this.energy<this.barrierHeight;t.fillStyle=s?"#ff5722":"#4caf50",t.font="bold 14px Merriweather",t.textAlign="center",t.fillText(s?"⚡ Quantum Tunneling (E < V₀)":"✓ Classical Transmission (E > V₀)",this.width/2,25),t.font="bold 13px Arial",t.textAlign="left",t.fillStyle="#4caf50",t.fillText(`T = ${e.toFixed(4)}`,this.regionLeft,50),t.textAlign="right",t.fillStyle="#f44336",t.fillText(`R = ${i.toFixed(4)}`,this.regionRight,50)}loop(t){this.lastTimestamp||(this.lastTimestamp=t);const e=Math.min(t-this.lastTimestamp,100);this.lastTimestamp=t,this.update(e),this.draw(),requestAnimationFrame(this.loop)}}class L{canvas;ctx;width;height;currentE=3;currentV0=5;currentA=.5;constructor(t){this.canvas=t;const e=t.getContext("2d");if(!e)throw new Error("2D context not found");this.ctx=e,this.width=t.width,this.height=t.height,this.handleResize(),window.addEventListener("resize",()=>this.handleResize())}handleResize(){this.canvas.parentElement&&(this.canvas.width=this.canvas.parentElement.clientWidth,this.canvas.height=this.canvas.parentElement.clientHeight||200,this.width=this.canvas.width,this.height=this.canvas.height,this.draw())}getT(t,e,i){if(t<=.01)return 0;if(Math.abs(t-e)<.01)return 1/(1+i*e*(i*e)*.26);if(t<e){const s=Math.sqrt(e-t)*i*5.12,r=Math.sinh(s);return 1/(1+e*e*r*r/(4*t*(e-t)))}else{const s=Math.sqrt(t-e)*i*5.12,r=Math.sin(s);return 1/(1+e*e*r*r/(4*t*(t-e)))}}update(t,e,i){this.currentE=t,this.currentV0=e,this.currentA=i,this.draw()}draw(){const t=this.ctx;t.clearRect(0,0,this.width,this.height);const e={left:45,right:20,top:20,bottom:35},i=this.width-e.left-e.right,s=this.height-e.top-e.bottom,r=10;t.strokeStyle="#b2bec3",t.lineWidth=1,t.beginPath(),t.moveTo(e.left,e.top),t.lineTo(e.left,e.top+s),t.lineTo(e.left+i,e.top+s),t.stroke(),t.fillStyle="#636e72",t.font="11px Arial",t.textAlign="center",t.fillText("E (eV)",e.left+i/2,this.height-5),t.save(),t.translate(12,e.top+s/2),t.rotate(-Math.PI/2),t.fillText("T",0,0),t.restore(),t.textAlign="right",t.textBaseline="middle",[0,.5,1].forEach(l=>{const a=e.top+s*(1-l);t.fillStyle="#999",t.fillText(l.toFixed(1),e.left-5,a),t.beginPath(),t.strokeStyle="#eee",t.moveTo(e.left,a),t.lineTo(e.left+i,a),t.stroke()}),t.textAlign="center",t.textBaseline="top";for(let l=0;l<=r;l+=2){const a=e.left+l/r*i;t.fillStyle="#999",t.fillText(`${l}`,a,e.top+s+5)}const g=e.left+this.currentV0/r*i;t.beginPath(),t.strokeStyle="rgba(255, 87, 34, 0.5)",t.setLineDash([4,4]),t.moveTo(g,e.top),t.lineTo(g,e.top+s),t.stroke(),t.setLineDash([]),t.fillStyle="#ff5722",t.font="10px Arial",t.textAlign="center",t.fillText("V₀",g,e.top-5),t.beginPath(),t.strokeStyle="#3d5afe",t.lineWidth=2;const b=400;for(let l=0;l<=b;l++){const a=l/b*r;if(a<.05)continue;const o=this.getT(a,this.currentV0,this.currentA),n=e.left+a/r*i,h=e.top+s*(1-o);l<=1||a<.1?t.moveTo(n,h):t.lineTo(n,h)}t.stroke();const u=this.getT(this.currentE,this.currentV0,this.currentA),p=e.left+this.currentE/r*i,c=e.top+s*(1-u);t.beginPath(),t.fillStyle="#3d5afe",t.shadowColor="rgba(61, 90, 254, 0.5)",t.shadowBlur=8,t.arc(p,c,5,0,Math.PI*2),t.fill(),t.shadowBlur=0,t.fillStyle="#3d5afe",t.font="bold 11px Arial",t.textAlign="left",t.fillText(`T = ${u.toFixed(3)}`,p+10,c-5)}}document.addEventListener("DOMContentLoaded",()=>{const y=document.getElementById("barrier-canvas"),t=document.getElementById("t-graph-canvas");if(!y)throw new Error("Simulation canvas not found");const e=new v(y),i=t?new L(t):null,s=document.getElementById("particle-energy"),r=document.getElementById("barrier-height"),g=document.getElementById("barrier-width"),b=document.getElementById("energy-val"),u=document.getElementById("barrier-height-val"),p=document.getElementById("barrier-width-val"),c=document.getElementById("transmission-val"),l=document.getElementById("reflection-val"),a=document.getElementById("ratio-val"),o=document.getElementById("regime-val"),n=()=>{const h=parseFloat(s.value),d=parseFloat(r.value),f=parseFloat(g.value);e.energy=h,e.barrierHeight=d,e.barrierWidth=f,b.textContent=`${h.toFixed(1)} eV`,u.textContent=`${d.toFixed(1)} eV`,p.textContent=`${f.toFixed(2)} nm`;const m=e.getTransmission(),w=e.getReflection(),T=h/d;c.textContent=m.toFixed(4),l.textContent=w.toFixed(4),a.textContent=T.toFixed(2),m>.5?c.style.color="#4caf50":m>.01?c.style.color="#ff9800":c.style.color="#f44336",h<d?(o.textContent="Tunneling",o.style.color="#ff5722"):(o.textContent="Classical",o.style.color="#4caf50"),i&&i.update(h,d,f)};s.addEventListener("input",n),r.addEventListener("input",n),g.addEventListener("input",n),n()});
