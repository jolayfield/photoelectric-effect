import"./style-BgzER3dT.js";class R{canvas;ctx;width;height;pinnedStates=[];previewN=1;boxWidth=1;showProbability=!1;animationSpeed=1;time=0;lastTimestamp=0;isAnimating=!1;boxLeft=0;boxRight=0;boxTop=0;boxBottom=0;waveBaseline=0;constructor(t){this.canvas=t;const e=t.getContext("2d");if(!e)throw new Error("2D context not found");this.ctx=e,this.width=t.width,this.height=t.height,this.handleResize(),window.addEventListener("resize",()=>this.handleResize()),this.loop=this.loop.bind(this),requestAnimationFrame(this.loop)}handleResize(){this.canvas.parentElement&&(this.canvas.width=this.canvas.parentElement.clientWidth,this.canvas.height=this.canvas.parentElement.clientHeight,this.width=this.canvas.width,this.height=this.canvas.height,this.updateLayout())}updateLayout(){this.boxLeft=80,this.boxRight=this.width-40-40,this.boxTop=40,this.boxBottom=this.height-40,this.waveBaseline=this.height/2}psi(t,e){return Math.sqrt(2)*Math.sin(t*Math.PI*e)}energy(t){return t*t}update(t){this.isAnimating&&(this.time+=t*.001*this.animationSpeed)}resetTime(){this.time=0}draw(){this.ctx.clearRect(0,0,this.width,this.height);const t=this.ctx,e=this.boxRight-this.boxLeft,l=this.boxBottom-this.boxTop;t.strokeStyle="#2d3436",t.lineWidth=3,t.lineCap="round",t.beginPath(),t.moveTo(this.boxLeft,this.boxTop),t.lineTo(this.boxLeft,this.boxBottom),t.stroke(),t.beginPath(),t.moveTo(this.boxRight,this.boxTop),t.lineTo(this.boxRight,this.boxBottom),t.stroke(),t.beginPath(),t.strokeStyle="#b2bec3",t.lineWidth=1,t.setLineDash([5,5]),t.moveTo(this.boxLeft,this.waveBaseline),t.lineTo(this.boxRight,this.waveBaseline),t.stroke(),t.setLineDash([]);const o=t.createLinearGradient(this.boxLeft-40,0,this.boxLeft,0);o.addColorStop(0,"rgba(45, 52, 54, 0.3)"),o.addColorStop(1,"rgba(45, 52, 54, 0.05)"),t.fillStyle=o,t.fillRect(this.boxLeft-40,this.boxTop,40,l);const n=t.createLinearGradient(this.boxRight,0,this.boxRight+40,0);n.addColorStop(0,"rgba(45, 52, 54, 0.05)"),n.addColorStop(1,"rgba(45, 52, 54, 0.3)"),t.fillStyle=n,t.fillRect(this.boxRight,this.boxTop,40,l),t.fillStyle="#636e72",t.font="bold 14px Arial",t.textAlign="center",t.fillText("V = ∞",this.boxLeft-20,this.boxTop+20),t.fillText("V = ∞",this.boxRight+20,this.boxTop+20),t.fillText("V = 0",this.boxLeft+e/2,this.boxBottom+20);const f=300,w=this.showProbability?l*.12:l*.35;this.drawWavefunction(t,f,w),t.fillStyle="#636e72",t.font="12px Arial",t.textAlign="center",t.fillText("0",this.boxLeft,this.boxBottom+35),t.fillText("L",this.boxRight,this.boxBottom+35),t.fillStyle="#2d3436",t.font="bold 14px Merriweather",t.textAlign="center";const i=[...this.pinnedStates.map(d=>({n:d.n,c:d.c}))];this.pinnedStates.some(d=>d.n===this.previewN)||i.push({n:this.previewN,c:1}),i.sort((d,r)=>d.n-r.n);let a="";this.showProbability?i.length===1?a=`|ψ${this.subscript(i[0].n)}(x)|²`:a="|Σ cₙψₙ|²":i.length===1?a=`ψ${this.subscript(i[0].n)}(x, t)`:a="Re(Σ cₙψₙe^{-iωₙt})",t.fillText(a,this.boxLeft+e/2,this.boxTop-15)}subscript(t){return["₀","₁","₂","₃","₄","₅","₆","₇","₈"][t]||`${t}`}drawWavefunction(t,e,l){const o=this.boxRight-this.boxLeft,n=[...this.pinnedStates.map(i=>({n:i.n,c:i.c}))];if(this.pinnedStates.some(i=>i.n===this.previewN)||n.push({n:this.previewN,c:1}),n.length===0)return;const f=n.reduce((i,a)=>i+a.c*a.c,0),w=1/Math.sqrt(f);if(this.showProbability){t.beginPath(),t.moveTo(this.boxLeft,this.waveBaseline);for(let r=0;r<=e;r++){const m=r/e,c=this.boxLeft+m*o;let v=0,y=0;for(const u of n){const h=this.psi(u.n,m),s=this.energy(u.n),g=u.c*w;v+=g*h*Math.cos(s*this.time),y+=g*h*Math.sin(s*this.time)}const x=v*v+y*y,S=this.waveBaseline-x*l;t.lineTo(c,S)}t.lineTo(this.boxRight,this.waveBaseline),t.closePath();const i=t.createLinearGradient(0,this.waveBaseline-l,0,this.waveBaseline),a=n.length>1?"rgba(156, 39, 176, 0.4)":"rgba(61, 90, 254, 0.4)",d=n.length>1?"rgba(156, 39, 176, 0.05)":"rgba(61, 90, 254, 0.05)";i.addColorStop(0,a),i.addColorStop(1,d),t.fillStyle=i,t.fill(),t.beginPath(),t.moveTo(this.boxLeft,this.waveBaseline);for(let r=0;r<=e;r++){const m=r/e,c=this.boxLeft+m*o;let v=0,y=0;for(const u of n){const h=this.psi(u.n,m),s=this.energy(u.n),g=u.c*w;v+=g*h*Math.cos(s*this.time),y+=g*h*Math.sin(s*this.time)}const x=v*v+y*y,S=this.waveBaseline-x*l;t.lineTo(c,S)}t.strokeStyle=n.length>1?"#9c27b0":"#3d5afe",t.lineWidth=2.5,t.stroke()}else{t.beginPath();for(let i=0;i<=e;i++){const a=i/e,d=this.boxLeft+a*o;let r=0;for(const c of n)r+=c.c*w*this.psi(c.n,a)*Math.cos(this.energy(c.n)*this.time);const m=this.waveBaseline-r*l;i===0?t.moveTo(d,m):t.lineTo(d,m)}t.strokeStyle=n.length>1?"#9c27b0":"#3d5afe",t.lineWidth=2.5,t.stroke(),t.beginPath(),t.moveTo(this.boxLeft,this.waveBaseline);for(let i=0;i<=e;i++){const a=i/e,d=this.boxLeft+a*o;let r=0;for(const c of n)r+=c.c*w*this.psi(c.n,a)*Math.cos(this.energy(c.n)*this.time);const m=this.waveBaseline-r*l;t.lineTo(d,Math.min(m,this.waveBaseline))}t.lineTo(this.boxRight,this.waveBaseline),t.closePath(),t.fillStyle=n.length>1?"rgba(156, 39, 176, 0.12)":"rgba(61, 90, 254, 0.12)",t.fill(),t.beginPath(),t.moveTo(this.boxLeft,this.waveBaseline);for(let i=0;i<=e;i++){const a=i/e,d=this.boxLeft+a*o;let r=0;for(const c of n)r+=c.c*w*this.psi(c.n,a)*Math.cos(this.energy(c.n)*this.time);const m=this.waveBaseline-r*l;t.lineTo(d,Math.max(m,this.waveBaseline))}t.lineTo(this.boxRight,this.waveBaseline),t.closePath(),t.fillStyle="rgba(255, 64, 129, 0.12)",t.fill()}}loop(t){this.lastTimestamp||(this.lastTimestamp=t);const e=Math.min(t-this.lastTimestamp,100);this.lastTimestamp=t,this.update(e),this.draw(),requestAnimationFrame(this.loop)}}class A{canvas;ctx;width;height;activeStates=[1];maxN=8;constructor(t){this.canvas=t;const e=t.getContext("2d");if(!e)throw new Error("2D context not found");this.ctx=e,this.width=t.width,this.height=t.height,this.handleResize(),window.addEventListener("resize",()=>this.handleResize())}handleResize(){this.canvas.parentElement&&(this.canvas.width=this.canvas.parentElement.clientWidth,this.canvas.height=this.canvas.parentElement.clientHeight||200,this.width=this.canvas.width,this.height=this.canvas.height,this.draw())}getY(t){const e=t*t,l=this.maxN*this.maxN,o=e/l;return this.height-30-o*(this.height-60)}draw(){this.ctx.clearRect(0,0,this.width,this.height);const t=this.ctx,e=50,l=this.width-70;t.font="12px Arial",t.textAlign="right",t.textBaseline="middle";for(let o=1;o<=this.maxN;o++){const n=this.getY(o),f=this.activeStates.includes(o);t.beginPath(),t.strokeStyle=f?"#9c27b0":"#ddd",t.lineWidth=f?2.5:1,t.moveTo(e,n),t.lineTo(e+l,n),t.stroke(),t.fillStyle=f?"#9c27b0":"#999",t.font=f?"bold 12px Arial":"12px Arial",t.fillText(`n=${o}`,e-5,n),t.textAlign="left",t.fillText(`${o*o} E₁`,e+l+5,n),t.textAlign="right",f&&(t.beginPath(),t.fillStyle="#9c27b0",t.arc(e+l/2,n,6,0,Math.PI*2),t.fill())}}}document.addEventListener("DOMContentLoaded",()=>{const L=document.getElementById("pbox-canvas"),t=document.getElementById("energy-level-canvas");if(!L||!t)throw new Error("Canvas elements not found");const e=new R(L),l=new A(t),o=document.getElementById("quantum-n"),n=document.getElementById("quantum-n-val"),f=document.getElementById("display-mode"),w=document.getElementById("add-state"),i=document.getElementById("clear-states"),a=document.getElementById("coefficients-body"),d=document.getElementById("toggle-animate"),r=document.getElementById("reset-animate"),m=document.getElementById("energy-val"),c=document.getElementById("nodes-val"),v=document.getElementById("wavelength-val"),y=h=>{a.innerHTML="",h.forEach(s=>{const g=document.createElement("tr");g.style.borderBottom="1px solid var(--border-color)";const b=document.createElement("td");b.style.padding="0.5rem",b.style.borderRight="1px solid var(--border-color)",b.textContent=s.isPreview?`n=${s.n} (preview)`:`n=${s.n}`,s.isPreview&&(b.style.color="var(--text-dim)"),g.appendChild(b);const B=document.createElement("td");if(B.style.padding="0.5rem",B.style.borderRight="1px solid var(--border-color)",s.isPreview)B.textContent="1.0",B.style.color="var(--text-dim)";else{const p=document.createElement("input");p.type="number",p.value=s.c.toString(),p.step="0.1",p.style.width="60px",p.style.padding="0.2rem",p.style.border="1px solid var(--border-color)",p.style.borderRadius="4px",p.addEventListener("input",()=>{const T=e.pinnedStates.findIndex(C=>C.n===s.n);T!==-1&&(e.pinnedStates[T].c=parseFloat(p.value)||1)}),B.appendChild(p)}g.appendChild(B);const E=document.createElement("td");if(E.style.padding="0.5rem",E.style.textAlign="right",!s.isPreview){const p=document.createElement("button");p.innerHTML="&times;",p.className="btn btn-outline",p.style.padding="0.1rem 0.4rem",p.title="Remove state",p.onclick=()=>{e.pinnedStates=e.pinnedStates.filter(T=>T.n!==s.n),x()},E.appendChild(p)}g.appendChild(E),a.appendChild(g)})},x=()=>{const h=parseInt(o.value);e.previewN=h,e.showProbability=f.value==="probability";const s=e.pinnedStates.map(b=>({...b,isPreview:!1}));e.pinnedStates.some(b=>b.n===e.previewN)||s.push({n:e.previewN,c:1,isPreview:!0}),s.sort((b,B)=>b.n-B.n);const g=s.length>1;d.textContent=e.isAnimating?"Pause":"Animate Wavefunction",n.textContent=`n = ${h}`,g?(m.textContent="Superposition",c.textContent="N/A",v.textContent="N/A"):(m.textContent=`${h*h} E₁`,c.textContent=`${h-1}`,h===1?v.textContent="2L":h===2?v.textContent="L":v.textContent=`2L/${h}`),y(s),l.activeStates=s.map(b=>b.n),l.draw()};o.addEventListener("input",x),f.addEventListener("change",x),w.addEventListener("click",()=>{const h=parseInt(o.value);e.pinnedStates.some(s=>s.n===h)||(e.pinnedStates.push({n:h,c:1}),e.pinnedStates.sort((s,g)=>s.n-g.n)),x()}),i.addEventListener("click",()=>{e.pinnedStates=[],x()}),d.addEventListener("click",()=>{e.isAnimating=!e.isAnimating,x()}),r.addEventListener("click",()=>{e.resetTime(),e.isAnimating=!1,x()});const S=document.getElementById("animation-speed"),u=document.getElementById("speed-val");S.addEventListener("input",()=>{const h=parseFloat(S.value);e.animationSpeed=h,u.textContent=h.toFixed(1)}),x()});
