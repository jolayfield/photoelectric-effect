import"./style-BgzER3dT.js";class q{canvas;ctx;width=0;height=0;gridSize=200;heatmapData=null;lastParams="";params={nx:1,ny:1,Lx:1,Ly:1,showProbability:!1};plotLeft=0;plotTop=0;plotW=0;plotH=0;constructor(t){this.canvas=t;const s=t.getContext("2d");if(!s)throw new Error("2D context not found");this.ctx=s,this.handleResize(),window.addEventListener("resize",()=>this.handleResize())}handleResize(){this.canvas.parentElement&&(this.canvas.width=this.canvas.parentElement.clientWidth,this.canvas.height=this.canvas.parentElement.clientHeight,this.width=this.canvas.width,this.height=this.canvas.height,this.lastParams="",this.draw())}update(t){Object.assign(this.params,t),this.draw()}psi(t,s){const{nx:a,ny:l,Lx:h,Ly:m}=this.params;return 2/Math.sqrt(h*m)*Math.sin(a*Math.PI*t/h)*Math.sin(l*Math.PI*s/m)}psiSq(t,s){const a=this.psi(t,s);return a*a}energy(){const{nx:t,ny:s,Lx:a,Ly:l}=this.params;return t*t/(a*a)+s*s/(l*l)}colormapDiverging(t){if(t<.5){const s=t/.5,a=Math.round(30+225*s),l=Math.round(60+195*s),h=Math.round(200+55*s);return[a,l,h]}else{const s=(t-.5)/.5,a=255,l=Math.round(255-195*s),h=Math.round(255-205*s);return[a,l,h]}}colormapSequential(t){const s=Math.round(255-203*t),a=Math.round(255-241*t),l=Math.round(255-174*t);return[s,a,l]}computeLayout(){const{Lx:a,Ly:l}=this.params,h=this.width-120-50-20,m=this.height-120,i=a/l;h/m>i?(this.plotH=m,this.plotW=this.plotH*i):(this.plotW=h,this.plotH=this.plotW/i),this.plotLeft=60+(h-this.plotW)/2,this.plotTop=60+(m-this.plotH)/2}computeHeatmap(){const t=JSON.stringify(this.params)+`|${this.width}|${this.height}`;if(t===this.lastParams&&this.heatmapData)return;this.lastParams=t,this.computeLayout();const s=this.gridSize,{Lx:a,Ly:l,showProbability:h}=this.params,m=new Array(s*s);let i=1/0,p=-1/0;for(let e=0;e<s;e++){const n=(e+.5)/s*l;for(let o=0;o<s;o++){const c=(o+.5)/s*a,r=h?this.psiSq(c,n):this.psi(c,n);m[e*s+o]=r,r<i&&(i=r),r>p&&(p=r)}}if(h)i=0;else{const e=Math.max(Math.abs(i),Math.abs(p));i=-e,p=e}const x=p-i||1,d=document.createElement("canvas");d.width=s,d.height=s;const b=d.getContext("2d"),y=b.createImageData(s,s);for(let e=0;e<s;e++)for(let n=0;n<s;n++){const c=(m[e*s+n]-i)/x,[r,T,g]=h?this.colormapSequential(c):this.colormapDiverging(c),v=((s-1-e)*s+n)*4;y.data[v]=r,y.data[v+1]=T,y.data[v+2]=g,y.data[v+3]=255}this.heatmapData=y,b.putImageData(y,0,0),this.ctx.imageSmoothingEnabled=!0,this.ctx.imageSmoothingQuality="high"}draw(){if(this.width===0||this.height===0)return;this.computeLayout(),this.computeHeatmap();const t=this.ctx;t.clearRect(0,0,this.width,this.height);const{Lx:s,Ly:a,nx:l,ny:h,showProbability:m}=this.params,i=this.gridSize;if(this.heatmapData){const d=document.createElement("canvas");d.width=i,d.height=i,d.getContext("2d").putImageData(this.heatmapData,0,0),t.save(),t.imageSmoothingEnabled=!0,t.imageSmoothingQuality="high",t.drawImage(d,this.plotLeft,this.plotTop,this.plotW,this.plotH),t.restore()}t.strokeStyle="#2d3436",t.lineWidth=2,t.strokeRect(this.plotLeft,this.plotTop,this.plotW,this.plotH),this.drawContourLines(t),t.fillStyle="#636e72",t.font="13px Lato, sans-serif",t.textAlign="center",t.textBaseline="top";const p=5;for(let d=0;d<=p;d++){const b=d/p,y=this.plotLeft+b*this.plotW,e=(b*s).toFixed(1);t.fillText(e,y,this.plotTop+this.plotH+8),t.beginPath(),t.moveTo(y,this.plotTop+this.plotH),t.lineTo(y,this.plotTop+this.plotH+5),t.strokeStyle="#636e72",t.lineWidth=1,t.stroke()}t.textAlign="right",t.textBaseline="middle";for(let d=0;d<=p;d++){const b=d/p,y=this.plotTop+this.plotH-b*this.plotH,e=(b*a).toFixed(1);t.fillText(e,this.plotLeft-8,y),t.beginPath(),t.moveTo(this.plotLeft-5,y),t.lineTo(this.plotLeft,y),t.strokeStyle="#636e72",t.lineWidth=1,t.stroke()}t.fillStyle="#2d3436",t.font="bold 14px Lato, sans-serif",t.textAlign="center",t.textBaseline="top",t.fillText("x",this.plotLeft+this.plotW/2,this.plotTop+this.plotH+28),t.save(),t.translate(this.plotLeft-40,this.plotTop+this.plotH/2),t.rotate(-Math.PI/2),t.textBaseline="middle",t.fillText("y",0,0),t.restore(),t.fillStyle="#2d3436",t.font="bold 15px Lora, serif",t.textAlign="center",t.textBaseline="bottom";const x=m?`|ψ(x,y)|²   nx=${l}, ny=${h}`:`ψ(x,y)   nx=${l}, ny=${h}`;t.fillText(x,this.plotLeft+this.plotW/2,this.plotTop-12),this.drawColorBar(t)}drawContourLines(t){const{Lx:s,Ly:a,nx:l,ny:h,showProbability:m}=this.params,i=150,p=[];let x=1/0,d=-1/0;for(let e=0;e<=i;e++){p[e]=[];const n=e/i*a;for(let o=0;o<=i;o++){const c=o/i*s,r=m?this.psiSq(c,n):this.psi(c,n);p[e][o]=r,r<x&&(x=r),r>d&&(d=r)}}if(m)x=0;else{const e=Math.max(Math.abs(x),Math.abs(d));x=-e,d=e}const b=[],y=8;for(let e=1;e<y;e++)b.push(x+e/y*(d-x));t.save(),t.beginPath(),t.rect(this.plotLeft,this.plotTop,this.plotW,this.plotH),t.clip();for(const e of b){t.beginPath(),t.strokeStyle="rgba(0, 0, 0, 0.25)",t.lineWidth=.8;for(let n=0;n<i;n++)for(let o=0;o<i;o++){const c=p[n][o],r=p[n][o+1],T=p[n+1][o],g=p[n+1][o+1],v=(c>=e?8:0)|(r>=e?4:0)|(g>=e?2:0)|(T>=e?1:0);if(v===0||v===15)continue;const I=(S,C)=>{const D=C-S;return D===0?.5:(e-S)/D},B=I(c,r),P=I(T,g),k=I(c,T),H=I(r,g),w=S=>this.plotLeft+S/i*this.plotW,E=S=>this.plotTop+this.plotH-S/i*this.plotH,f={x:w(o+B),y:E(n)},u={x:w(o+P),y:E(n+1)},M={x:w(o),y:E(n+k)},W={x:w(o+1),y:E(n+H)},L=(S,C)=>{t.moveTo(S.x,S.y),t.lineTo(C.x,C.y)};switch(v){case 1:case 14:L(M,u);break;case 2:case 13:L(u,W);break;case 3:case 12:L(M,W);break;case 4:case 11:L(f,W);break;case 5:(c+g)/2>=e?(L(f,M),L(u,W)):(L(f,W),L(u,M));break;case 6:case 9:L(f,u);break;case 7:case 8:L(f,M);break;case 10:(c+g)/2>=e?(L(f,W),L(u,M)):(L(f,M),L(u,W));break}}t.stroke()}if(!m){t.beginPath(),t.strokeStyle="rgba(0, 0, 0, 0.6)",t.lineWidth=1.5,t.setLineDash([4,3]);const e=0;for(let n=0;n<i;n++)for(let o=0;o<i;o++){const c=p[n][o],r=p[n][o+1],T=p[n+1][o],g=p[n+1][o+1],v=(c>=e?8:0)|(r>=e?4:0)|(g>=e?2:0)|(T>=e?1:0);if(v===0||v===15)continue;const I=(u,M)=>{const W=M-u;return W===0?.5:(e-u)/W},B=u=>this.plotLeft+u/i*this.plotW,P=u=>this.plotTop+this.plotH-u/i*this.plotH,k={x:B(o+I(c,r)),y:P(n)},H={x:B(o+I(T,g)),y:P(n+1)},w={x:B(o),y:P(n+I(c,T))},E={x:B(o+1),y:P(n+I(r,g))},f=(u,M)=>{t.moveTo(u.x,u.y),t.lineTo(M.x,M.y)};switch(v){case 1:case 14:f(w,H);break;case 2:case 13:f(H,E);break;case 3:case 12:f(w,E);break;case 4:case 11:f(k,E);break;case 5:(c+g)/2>=e?(f(k,w),f(H,E)):(f(k,E),f(H,w));break;case 6:case 9:f(k,H);break;case 7:case 8:f(k,w);break;case 10:(c+g)/2>=e?(f(k,E),f(H,w)):(f(k,w),f(H,E));break}}t.stroke(),t.setLineDash([])}t.restore()}drawColorBar(t){const a=this.plotH,l=this.plotLeft+this.plotW+20,h=this.plotTop,{showProbability:m}=this.params;for(let i=0;i<a;i++){const p=1-i/a,[x,d,b]=m?this.colormapSequential(p):this.colormapDiverging(p);t.fillStyle=`rgb(${x},${d},${b})`,t.fillRect(l,h+i,20,1)}t.strokeStyle="#2d3436",t.lineWidth=1,t.strokeRect(l,h,20,a),t.fillStyle="#636e72",t.font="11px Lato, sans-serif",t.textAlign="left",t.textBaseline="middle",m?(t.fillText("max",l+20+5,h+6),t.fillText("0",l+20+5,h+a-2)):(t.fillText("+",l+20+5,h+6),t.fillText("0",l+20+5,h+a/2),t.fillText("−",l+20+5,h+a-2))}}document.addEventListener("DOMContentLoaded",()=>{const $=document.getElementById("pbox2d-canvas");if(!$)throw new Error("Canvas element not found");const t=new q($),s=document.getElementById("quantum-nx"),a=document.getElementById("quantum-ny"),l=document.getElementById("box-lx"),h=document.getElementById("box-ly"),m=document.getElementById("display-mode"),i=document.getElementById("nx-val"),p=document.getElementById("ny-val"),x=document.getElementById("lx-val"),d=document.getElementById("ly-val"),b=document.getElementById("energy-val"),y=document.getElementById("nodes-x-val"),e=document.getElementById("nodes-y-val"),n=document.getElementById("degeneracy-val"),o=()=>{const c=parseInt(s.value),r=parseInt(a.value),T=parseFloat(l.value),g=parseFloat(h.value),v=m.value==="probability";i.innerHTML=`n<sub>x</sub> = ${c}`,p.innerHTML=`n<sub>y</sub> = ${r}`,x.innerHTML=`L<sub>x</sub> = ${T.toFixed(1)}`,d.innerHTML=`L<sub>y</sub> = ${g.toFixed(1)}`,t.update({nx:c,ny:r,Lx:T,Ly:g,showProbability:v});const I=t.energy();b.textContent=`${I.toFixed(2)} E₁`,y.textContent=`${c-1}`,e.textContent=`${r-1}`,Math.abs(T-g)<.01&&c!==r?n.textContent=`2-fold (${c},${r}) ↔ (${r},${c})`:n.textContent="—"};s.addEventListener("input",o),a.addEventListener("input",o),l.addEventListener("input",o),h.addEventListener("input",o),m.addEventListener("change",o),o()});
