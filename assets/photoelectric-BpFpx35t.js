import"./style-BgzER3dT.js";import{C as B}from"./chart-vendor-sRkgK8jz.js";class F{canvas;ctx;width;height;photons;electrons;wavelength;intensity;workFunction;voltage;metalName="Cesium";hc_eV_nm=1239.8;metalY=0;plateWidth=0;lastTime=0;constructor(t){this.canvas=t;const e=t.getContext("2d");if(!e)throw new Error("Could not get 2D context");this.ctx=e,this.width=t.width,this.height=t.height,this.photons=[],this.electrons=[],this.wavelength=500,this.intensity=50,this.workFunction=2.1,this.voltage=0,this.handleResize(),window.addEventListener("resize",()=>this.handleResize()),this.loop=this.loop.bind(this),requestAnimationFrame(this.loop)}handleResize(){const t=this.canvas.parentElement;t&&(this.canvas.width=t.clientWidth,this.canvas.height=t.clientHeight,this.width=this.canvas.width,this.height=this.canvas.height,this.metalY=this.height*.8,this.plateWidth=this.width*.6)}updateParams(t,e,s,i){this.wavelength=t,this.intensity=e,this.workFunction=s,this.metalName=i}getPhotonEnergy(){return this.hc_eV_nm/this.wavelength}getFrequency(){return 299792.458/this.wavelength}wavelengthToColor(t){let e=0,s=0,i=0;return t>=380&&t<440?(e=-(t-440)/60,s=0,i=1):t>=440&&t<490?(e=0,s=(t-440)/50,i=1):t>=490&&t<510?(e=0,s=1,i=-(t-510)/20):t>=510&&t<580?(e=(t-510)/70,s=1,i=0):t>=580&&t<645?(e=1,s=-(t-645)/65,i=0):t>=645&&t<=780&&(e=1,s=0,i=0),t<380?"rgba(120, 0, 255, 0.5)":t>780?"rgba(200, 0, 0, 0.3)":`rgba(${Math.round(e*255)}, ${Math.round(s*255)}, ${Math.round(i*255)}, 0.8)`}spawnPhoton(){const t=this.intensity/20;Math.random()<.1*t&&this.photons.push({x:Math.random()*this.plateWidth+(this.width-this.plateWidth)/2,y:0,dy:5+Math.random()*2,color:this.wavelengthToColor(this.wavelength),energy:this.hc_eV_nm/this.wavelength})}update(t){this.spawnPhoton();for(let e=this.photons.length-1;e>=0;e--){let s=this.photons[e];s.y+=s.dy*t,s.y>=this.metalY&&(this.photons[e]=this.photons[this.photons.length-1],this.photons.pop(),this.tryEmitElectron(s.x,s.energy))}for(let e=this.electrons.length-1;e>=0;e--){let s=this.electrons[e];s.y+=s.dy*t,s.x+=s.dx*t,(s.y<0||s.x<0||s.x>this.width)&&(this.electrons[e]=this.electrons[this.electrons.length-1],this.electrons.pop())}}tryEmitElectron(t,e){if(e>this.workFunction){const s=e-this.workFunction,i=Math.sqrt(s)*3;this.electrons.push({x:t,y:this.metalY-5,dx:(Math.random()-.5)*2,dy:-i,ke:s})}}draw(){this.ctx.clearRect(0,0,this.width,this.height),this.ctx.fillStyle="#555";const t=(this.width-this.plateWidth)/2;this.ctx.fillRect(t,this.metalY,this.plateWidth,20),this.ctx.fillStyle="#aaa",this.ctx.font="14px Merriweather",this.ctx.textAlign="center",this.ctx.fillText(`${this.metalName} (${this.workFunction} eV)`,this.width/2,this.metalY+40);const e=this.wavelengthToColor(this.wavelength);this.ctx.fillStyle=e,this.ctx.shadowBlur=20,this.ctx.shadowColor=e,this.ctx.fillRect(0,0,this.width,5),this.ctx.shadowBlur=0;const s={};for(const i of this.photons)s[i.color]||(s[i.color]=[]),s[i.color].push(i);for(const i in s){this.ctx.fillStyle=i,this.ctx.shadowColor=i,this.ctx.shadowBlur=10,this.ctx.beginPath();for(const o of s[i])this.ctx.moveTo(o.x+6,o.y),this.ctx.arc(o.x,o.y,6,0,Math.PI*2);this.ctx.fill()}if(this.ctx.shadowBlur=0,this.electrons.length>0){this.ctx.fillStyle="#00f2ff",this.ctx.strokeStyle="#00f2ff",this.ctx.shadowColor="#00f2ff",this.ctx.shadowBlur=10,this.ctx.beginPath();for(const i of this.electrons)this.ctx.moveTo(i.x+4,i.y),this.ctx.arc(i.x,i.y,4,0,Math.PI*2);this.ctx.fill(),this.ctx.shadowBlur=0}}loop(t){this.lastTime||(this.lastTime=t);const e=t-this.lastTime;this.lastTime=t;const o=Math.min(e,100)/16.67;this.update(o),this.draw(),requestAnimationFrame(this.loop)}getLastKE(){const t=this.getPhotonEnergy();return Math.max(0,t-this.workFunction)}getCurrent(){return this.electrons.length*.1}}class I{canvas;chart;minFreq=0;maxFreq=2e3;h_val=41357e-19;mode="wavelength";currentPhi=2;constructor(t){this.canvas=t,this.chart=new B(t,{type:"line",data:{datasets:[{label:"Theoretical Max KE",data:[],borderColor:"#666",borderWidth:2,borderDash:[5,5],pointRadius:0,fill:!1,order:2},{label:"Current State",data:[],backgroundColor:"#00f2ff",borderColor:"transparent",borderWidth:0,pointRadius:6,pointHoverRadius:8,type:"scatter",order:1},{label:"Zero Line",data:[{x:200,y:0},{x:1e3,y:0}],borderColor:"#b2bec3",borderWidth:2,pointRadius:0,showLine:!0,fill:!1,order:3}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{x:{type:"linear",position:"bottom",title:{display:!0,text:"Wavelength λ (nm)",color:"#636e72"},grid:{color:"rgba(0, 0, 0, 0.1)"},ticks:{color:"#636e72",stepSize:100},min:200,max:1e3},y:{title:{display:!0,text:"Max Kinetic Energy (eV)",color:"#636e72"},grid:{color:e=>e.tick.value===0?"#636e72":"rgba(0, 0, 0, 0.1)",lineWidth:e=>e.tick.value===0?2:1},ticks:{color:"#636e72",callback:function(e){return Number(e)<0?"":e}},min:-.5}},plugins:{legend:{display:!1}}}})}setMode(t){if(this.mode===t)return;this.mode=t;const e=299792458e9,s=this.chart.data.datasets[1];s.data=s.data.map(o=>({x:e/o.x,y:o.y}));const i=this.chart.options.scales.x;t==="wavelength"?(i.title.text="Wavelength λ (nm)",i.min=200,i.max=1e3,i.ticks.callback=void 0,this.chart.data.datasets[2].data=[{x:200,y:0},{x:1e3,y:0}]):(i.title.text="Frequency ν (Hz)",i.min=0,i.max=2e15,i.ticks.callback=function(o){return Number(o).toExponential(1)},this.chart.data.datasets[2].data=[{x:0,y:0},{x:2e15,y:0}]),this.redrawTheoretical(),this.chart.update()}redrawTheoretical(){if(this.mode==="wavelength"){const t=[],e=1239.8/this.currentPhi;for(let s=200;s<=1e3;s+=10)if(s<e){const i=1239.8/s;t.push({x:s,y:i-this.currentPhi})}else{t.push({x:e,y:0});break}this.chart.data.datasets[0].data=t}else{const e=[{x:this.currentPhi/this.h_val,y:0},{x:2e15,y:this.h_val*2e15-this.currentPhi}];this.chart.data.datasets[0].data=e}}update(t,e,s){try{this.currentPhi=e;const i=t*1e12,o=299792.458/t;let h=1239.8/o-e;h<0&&(h=0);const g=this.mode==="wavelength"?o:i;this.redrawTheoretical(),this.chart.data.datasets[0].label=`Phi = ${e} eV`;const c={x:g,y:h},a=this.chart.data.datasets[1];a.data.push(c),Array.isArray(a.backgroundColor)||(a.backgroundColor=[]),a.backgroundColor.push(s),this.chart.update()}catch(i){console.error("Error updating graph:",i)}}reset(){try{const t=this.chart.data.datasets[1];t&&(t.data=[],t.backgroundColor=[]),this.chart.update()}catch(t){console.error("Error resetting graph:",t)}}}document.addEventListener("DOMContentLoaded",()=>{const u=document.getElementById("sim-canvas"),t=document.getElementById("ke-freq-chart");if(!u)throw new Error("Canvas not found");if(!t)throw new Error("Graph Canvas not found");const e=new F(u),s=new I(t),i=document.getElementById("intensity"),o=document.getElementById("wavelength"),n=document.getElementById("metal"),h=document.getElementById("intensity-val"),g=document.getElementById("wavelength-val"),c=document.getElementById("color-preview"),a=document.getElementById("photon-energy"),y=document.getElementById("work-function"),r=document.getElementById("max-ke"),l=()=>{const f=parseInt(i.value),x=parseInt(o.value),d=parseFloat(n.value),b=n.options[n.selectedIndex].text.split("(")[0].trim();e.updateParams(x,f,d,b);const C={2.1:"#2196f3",2.3:"#ffeb3b",4.7:"#ff5722",5.1:"#ffc107"}[d]||"#00f2ff",k=e.getFrequency();s.update(k,d,C),h&&(h.textContent=`${f}%`),g&&(g.textContent=`${x} nm`);const w=e.wavelengthToColor(x);c&&(c.style.background=w,c.style.boxShadow=`0 0 10px ${w}`);const v=e.getPhotonEnergy(),E=Math.max(0,v-d);a&&(a.textContent=`${v.toFixed(2)} eV`),y&&(y.textContent=`${d.toFixed(2)} eV`),r&&(r.textContent=`${E.toFixed(2)} eV`,E>0?(r.style.color="#00f2ff",r.style.textShadow="0 0 8px rgba(0, 242, 255, 0.5)"):(r.style.color="#ff073a",r.style.textShadow="none"))};i&&i.addEventListener("input",l),o&&o.addEventListener("input",l),n&&n.addEventListener("change",l);const m=document.getElementById("reset-graph-btn");m&&m.addEventListener("click",()=>{s.reset(),l()});const p=document.getElementById("graph-axis-select");p&&p.addEventListener("change",()=>{const f=p.value;s.setMode(f)}),l()});
