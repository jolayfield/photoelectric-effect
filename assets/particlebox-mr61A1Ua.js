import"./style-C8pZEPYV.js";class E{canvas;ctx;width;height;pinnedStates=[];previewN=1;boxWidth=1;showProbability=!1;time=0;lastTimestamp=0;isAnimating=!1;boxLeft=0;boxRight=0;boxTop=0;boxBottom=0;waveBaseline=0;constructor(t){this.canvas=t;const e=t.getContext("2d");if(!e)throw new Error("2D context not found");this.ctx=e,this.width=t.width,this.height=t.height,this.handleResize(),window.addEventListener("resize",()=>this.handleResize()),this.loop=this.loop.bind(this),requestAnimationFrame(this.loop)}handleResize(){this.canvas.parentElement&&(this.canvas.width=this.canvas.parentElement.clientWidth,this.canvas.height=this.canvas.parentElement.clientHeight,this.width=this.canvas.width,this.height=this.canvas.height,this.updateLayout())}updateLayout(){this.boxLeft=80,this.boxRight=this.width-40-40,this.boxTop=40,this.boxBottom=this.height-40,this.waveBaseline=this.height/2}psi(t,e){return Math.sqrt(2)*Math.sin(t*Math.PI*e)}energy(t){return t*t}update(t){this.isAnimating&&(this.time+=t*.003)}resetTime(){this.time=0}draw(){this.ctx.clearRect(0,0,this.width,this.height);const t=this.ctx,e=this.boxRight-this.boxLeft,h=this.boxBottom-this.boxTop;t.strokeStyle="#2d3436",t.lineWidth=3,t.lineCap="round",t.beginPath(),t.moveTo(this.boxLeft,this.boxTop),t.lineTo(this.boxLeft,this.boxBottom),t.stroke(),t.beginPath(),t.moveTo(this.boxRight,this.boxTop),t.lineTo(this.boxRight,this.boxBottom),t.stroke(),t.beginPath(),t.strokeStyle="#b2bec3",t.lineWidth=1,t.setLineDash([5,5]),t.moveTo(this.boxLeft,this.waveBaseline),t.lineTo(this.boxRight,this.waveBaseline),t.stroke(),t.setLineDash([]);const o=t.createLinearGradient(this.boxLeft-40,0,this.boxLeft,0);o.addColorStop(0,"rgba(45, 52, 54, 0.3)"),o.addColorStop(1,"rgba(45, 52, 54, 0.05)"),t.fillStyle=o,t.fillRect(this.boxLeft-40,this.boxTop,40,h);const s=t.createLinearGradient(this.boxRight,0,this.boxRight+40,0);s.addColorStop(0,"rgba(45, 52, 54, 0.05)"),s.addColorStop(1,"rgba(45, 52, 54, 0.3)"),t.fillStyle=s,t.fillRect(this.boxRight,this.boxTop,40,h),t.fillStyle="#636e72",t.font="bold 14px Arial",t.textAlign="center",t.fillText("V = ∞",this.boxLeft-20,this.boxTop+20),t.fillText("V = ∞",this.boxRight+20,this.boxTop+20),t.fillText("V = 0",this.boxLeft+e/2,this.boxBottom+20);const x=300,y=this.showProbability?h*.12:h*.35;this.drawWavefunction(t,x,y),t.fillStyle="#636e72",t.font="12px Arial",t.textAlign="center",t.fillText("0",this.boxLeft,this.boxBottom+35),t.fillText("L",this.boxRight,this.boxBottom+35),t.fillStyle="#2d3436",t.font="bold 14px Merriweather",t.textAlign="center";const i=[...this.pinnedStates.map(r=>({n:r.n,c:r.c}))];this.pinnedStates.some(r=>r.n===this.previewN)||i.push({n:this.previewN,c:1}),i.sort((r,l)=>r.n-l.n);let a="";this.showProbability?i.length===1?a=`|ψ${this.subscript(i[0].n)}(x)|²`:a="|Σ cₙψₙ|²":i.length===1?a=`ψ${this.subscript(i[0].n)}(x, t)`:a="Re(Σ cₙψₙe^{-iωₙt})",t.fillText(a,this.boxLeft+e/2,this.boxTop-15)}subscript(t){return["₀","₁","₂","₃","₄","₅","₆","₇","₈"][t]||`${t}`}drawWavefunction(t,e,h){const o=this.boxRight-this.boxLeft,s=[...this.pinnedStates.map(i=>({n:i.n,c:i.c}))];if(this.pinnedStates.some(i=>i.n===this.previewN)||s.push({n:this.previewN,c:1}),s.length===0)return;const x=s.reduce((i,a)=>i+a.c*a.c,0),y=1/Math.sqrt(x);if(this.showProbability){t.beginPath(),t.moveTo(this.boxLeft,this.waveBaseline);for(let l=0;l<=e;l++){const p=l/e,d=this.boxLeft+p*o;let v=0,u=0;for(const n of s){const b=this.psi(n.n,p),c=this.energy(n.n),f=n.c*y;v+=f*b*Math.cos(c*this.time),u+=f*b*Math.sin(c*this.time)}const w=v*v+u*u,g=this.waveBaseline-w*h;t.lineTo(d,g)}t.lineTo(this.boxRight,this.waveBaseline),t.closePath();const i=t.createLinearGradient(0,this.waveBaseline-h,0,this.waveBaseline),a=s.length>1?"rgba(156, 39, 176, 0.4)":"rgba(61, 90, 254, 0.4)",r=s.length>1?"rgba(156, 39, 176, 0.05)":"rgba(61, 90, 254, 0.05)";i.addColorStop(0,a),i.addColorStop(1,r),t.fillStyle=i,t.fill(),t.beginPath(),t.moveTo(this.boxLeft,this.waveBaseline);for(let l=0;l<=e;l++){const p=l/e,d=this.boxLeft+p*o;let v=0,u=0;for(const n of s){const b=this.psi(n.n,p),c=this.energy(n.n),f=n.c*y;v+=f*b*Math.cos(c*this.time),u+=f*b*Math.sin(c*this.time)}const w=v*v+u*u,g=this.waveBaseline-w*h;t.lineTo(d,g)}t.strokeStyle=s.length>1?"#9c27b0":"#3d5afe",t.lineWidth=2.5,t.stroke()}else{t.beginPath();for(let i=0;i<=e;i++){const a=i/e,r=this.boxLeft+a*o;let l=0;for(const d of s)l+=d.c*y*this.psi(d.n,a)*Math.cos(this.energy(d.n)*this.time);const p=this.waveBaseline-l*h;i===0?t.moveTo(r,p):t.lineTo(r,p)}t.strokeStyle=s.length>1?"#9c27b0":"#3d5afe",t.lineWidth=2.5,t.stroke(),t.beginPath(),t.moveTo(this.boxLeft,this.waveBaseline);for(let i=0;i<=e;i++){const a=i/e,r=this.boxLeft+a*o;let l=0;for(const d of s)l+=d.c*y*this.psi(d.n,a)*Math.cos(this.energy(d.n)*this.time);const p=this.waveBaseline-l*h;t.lineTo(r,Math.min(p,this.waveBaseline))}t.lineTo(this.boxRight,this.waveBaseline),t.closePath(),t.fillStyle=s.length>1?"rgba(156, 39, 176, 0.12)":"rgba(61, 90, 254, 0.12)",t.fill(),t.beginPath(),t.moveTo(this.boxLeft,this.waveBaseline);for(let i=0;i<=e;i++){const a=i/e,r=this.boxLeft+a*o;let l=0;for(const d of s)l+=d.c*y*this.psi(d.n,a)*Math.cos(this.energy(d.n)*this.time);const p=this.waveBaseline-l*h;t.lineTo(r,Math.max(p,this.waveBaseline))}t.lineTo(this.boxRight,this.waveBaseline),t.closePath(),t.fillStyle="rgba(255, 64, 129, 0.12)",t.fill()}}loop(t){this.lastTimestamp||(this.lastTimestamp=t);const e=Math.min(t-this.lastTimestamp,100);this.lastTimestamp=t,this.update(e),this.draw(),requestAnimationFrame(this.loop)}}class C{canvas;ctx;width;height;activeStates=[1];maxN=8;constructor(t){this.canvas=t;const e=t.getContext("2d");if(!e)throw new Error("2D context not found");this.ctx=e,this.width=t.width,this.height=t.height,this.handleResize(),window.addEventListener("resize",()=>this.handleResize())}handleResize(){this.canvas.parentElement&&(this.canvas.width=this.canvas.parentElement.clientWidth,this.canvas.height=this.canvas.parentElement.clientHeight||200,this.width=this.canvas.width,this.height=this.canvas.height,this.draw())}getY(t){const e=t*t,h=this.maxN*this.maxN,o=e/h;return this.height-30-o*(this.height-60)}draw(){this.ctx.clearRect(0,0,this.width,this.height);const t=this.ctx,e=50,h=this.width-70;t.font="12px Arial",t.textAlign="right",t.textBaseline="middle";for(let o=1;o<=this.maxN;o++){const s=this.getY(o),x=this.activeStates.includes(o);t.beginPath(),t.strokeStyle=x?"#9c27b0":"#ddd",t.lineWidth=x?2.5:1,t.moveTo(e,s),t.lineTo(e+h,s),t.stroke(),t.fillStyle=x?"#9c27b0":"#999",t.font=x?"bold 12px Arial":"12px Arial",t.fillText(`n=${o}`,e-5,s),t.textAlign="left",t.fillText(`${o*o} E₁`,e+h+5,s),t.textAlign="right",x&&(t.beginPath(),t.fillStyle="#9c27b0",t.arc(e+h/2,s,6,0,Math.PI*2),t.fill())}}}document.addEventListener("DOMContentLoaded",()=>{const B=document.getElementById("pbox-canvas"),t=document.getElementById("energy-level-canvas");if(!B||!t)throw new Error("Canvas elements not found");const e=new E(B),h=new C(t),o=document.getElementById("quantum-n"),s=document.getElementById("quantum-n-val"),x=document.getElementById("display-mode"),y=document.getElementById("add-state"),i=document.getElementById("clear-states"),a=document.getElementById("coefficients-body"),r=document.getElementById("toggle-animate"),l=document.getElementById("reset-animate"),p=document.getElementById("energy-val"),d=document.getElementById("nodes-val"),v=document.getElementById("wavelength-val"),u=g=>{a.innerHTML="",g.forEach(n=>{const b=document.createElement("tr");b.style.borderBottom="1px solid var(--border-color)";const c=document.createElement("td");c.style.padding="0.5rem",c.textContent=n.isPreview?`n=${n.n} (preview)`:`n=${n.n}`,n.isPreview&&(c.style.color="var(--text-dim)"),b.appendChild(c);const f=document.createElement("td");if(f.style.padding="0.5rem",n.isPreview)f.textContent="1.0",f.style.color="var(--text-dim)";else{const m=document.createElement("input");m.type="number",m.value=n.c.toString(),m.step="0.1",m.style.width="60px",m.style.padding="0.2rem",m.style.border="1px solid var(--border-color)",m.style.borderRadius="4px",m.addEventListener("input",()=>{const S=e.pinnedStates.findIndex(T=>T.n===n.n);S!==-1&&(e.pinnedStates[S].c=parseFloat(m.value)||1)}),f.appendChild(m)}b.appendChild(f);const L=document.createElement("td");if(L.style.padding="0.5rem",L.style.textAlign="right",!n.isPreview){const m=document.createElement("button");m.innerHTML="&times;",m.className="btn btn-outline",m.style.padding="0.1rem 0.4rem",m.title="Remove state",m.onclick=()=>{e.pinnedStates=e.pinnedStates.filter(S=>S.n!==n.n),w()},L.appendChild(m)}b.appendChild(L),a.appendChild(b)})},w=()=>{const g=parseInt(o.value);e.previewN=g,e.showProbability=x.value==="probability";const n=e.pinnedStates.map(c=>({...c,isPreview:!1}));e.pinnedStates.some(c=>c.n===e.previewN)||n.push({n:e.previewN,c:1,isPreview:!0}),n.sort((c,f)=>c.n-f.n);const b=n.length>1;r.textContent=e.isAnimating?"Pause":"Animate Wavefunction",s.textContent=`n = ${g}`,b?(p.textContent="Superposition",d.textContent="N/A",v.textContent="N/A"):(p.textContent=`${g*g} E₁`,d.textContent=`${g-1}`,g===1?v.textContent="2L":g===2?v.textContent="L":v.textContent=`2L/${g}`),u(n),h.activeStates=n.map(c=>c.n),h.draw()};o.addEventListener("input",w),x.addEventListener("change",w),y.addEventListener("click",()=>{const g=parseInt(o.value);e.pinnedStates.some(n=>n.n===g)||(e.pinnedStates.push({n:g,c:1}),e.pinnedStates.sort((n,b)=>n.n-b.n)),w()}),i.addEventListener("click",()=>{e.pinnedStates=[],w()}),r.addEventListener("click",()=>{e.isAnimating=!e.isAnimating,w()}),l.addEventListener("click",()=>{e.resetTime(),e.isAnimating=!1,w()}),w()});
