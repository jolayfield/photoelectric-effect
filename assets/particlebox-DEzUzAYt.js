import"./style-C8pZEPYV.js";class u{canvas;ctx;width;height;pinnedStates=[];previewN=1;boxWidth=1;showProbability=!1;time=0;lastTimestamp=0;isAnimating=!1;boxLeft=0;boxRight=0;boxTop=0;boxBottom=0;waveBaseline=0;constructor(t){this.canvas=t;const e=t.getContext("2d");if(!e)throw new Error("2D context not found");this.ctx=e,this.width=t.width,this.height=t.height,this.handleResize(),window.addEventListener("resize",()=>this.handleResize()),this.loop=this.loop.bind(this),requestAnimationFrame(this.loop)}handleResize(){this.canvas.parentElement&&(this.canvas.width=this.canvas.parentElement.clientWidth,this.canvas.height=this.canvas.parentElement.clientHeight,this.width=this.canvas.width,this.height=this.canvas.height,this.updateLayout())}updateLayout(){this.boxLeft=80,this.boxRight=this.width-40-40,this.boxTop=40,this.boxBottom=this.height-40,this.waveBaseline=this.height/2}psi(t,e){return Math.sqrt(2)*Math.sin(t*Math.PI*e)}energy(t){return t*t}update(t){this.isAnimating&&(this.time+=t*.003)}resetTime(){this.time=0}draw(){this.ctx.clearRect(0,0,this.width,this.height);const t=this.ctx,e=this.boxRight-this.boxLeft,h=this.boxBottom-this.boxTop;t.strokeStyle="#2d3436",t.lineWidth=3,t.lineCap="round",t.beginPath(),t.moveTo(this.boxLeft,this.boxTop),t.lineTo(this.boxLeft,this.boxBottom),t.stroke(),t.beginPath(),t.moveTo(this.boxRight,this.boxTop),t.lineTo(this.boxRight,this.boxBottom),t.stroke(),t.beginPath(),t.strokeStyle="#b2bec3",t.lineWidth=1,t.setLineDash([5,5]),t.moveTo(this.boxLeft,this.waveBaseline),t.lineTo(this.boxRight,this.waveBaseline),t.stroke(),t.setLineDash([]);const s=t.createLinearGradient(this.boxLeft-40,0,this.boxLeft,0);s.addColorStop(0,"rgba(45, 52, 54, 0.3)"),s.addColorStop(1,"rgba(45, 52, 54, 0.05)"),t.fillStyle=s,t.fillRect(this.boxLeft-40,this.boxTop,40,h);const i=t.createLinearGradient(this.boxRight,0,this.boxRight+40,0);i.addColorStop(0,"rgba(45, 52, 54, 0.05)"),i.addColorStop(1,"rgba(45, 52, 54, 0.3)"),t.fillStyle=i,t.fillRect(this.boxRight,this.boxTop,40,h),t.fillStyle="#636e72",t.font="bold 14px Arial",t.textAlign="center",t.fillText("V = ∞",this.boxLeft-20,this.boxTop+20),t.fillText("V = ∞",this.boxRight+20,this.boxTop+20),t.fillText("V = 0",this.boxLeft+e/2,this.boxBottom+20);const l=300,n=this.showProbability?h*.12:h*.35;this.drawWavefunction(t,l,n),t.fillStyle="#636e72",t.font="12px Arial",t.textAlign="center",t.fillText("0",this.boxLeft,this.boxBottom+35),t.fillText("L",this.boxRight,this.boxBottom+35),t.fillStyle="#2d3436",t.font="bold 14px Merriweather",t.textAlign="center";const a=Array.from(new Set([...this.pinnedStates,this.previewN])).sort((o,d)=>o-d);let r="";this.showProbability?a.length===1?r=`|ψ${this.subscript(a[0])}(x)|²`:r="|Σ cₙψₙ|²":a.length===1?r=`ψ${this.subscript(a[0])}(x, t)`:r="Re(Σ cₙψₙe^{-iωₙt})",t.fillText(r,this.boxLeft+e/2,this.boxTop-15)}subscript(t){return["₀","₁","₂","₃","₄","₅","₆","₇","₈"][t]||`${t}`}drawWavefunction(t,e,h){const s=this.boxRight-this.boxLeft,i=Array.from(new Set([...this.pinnedStates,this.previewN])).sort((n,a)=>n-a);if(i.length===0)return;const l=1/Math.sqrt(i.length);if(this.showProbability){t.beginPath(),t.moveTo(this.boxLeft,this.waveBaseline);for(let o=0;o<=e;o++){const d=o/e,c=this.boxLeft+d*s;let x=0,b=0;for(const m of i){const v=this.psi(m,d),p=this.energy(m);x+=l*v*Math.cos(p*this.time),b+=l*v*Math.sin(p*this.time)}const f=x*x+b*b,g=this.waveBaseline-f*h;t.lineTo(c,g)}t.lineTo(this.boxRight,this.waveBaseline),t.closePath();const n=t.createLinearGradient(0,this.waveBaseline-h,0,this.waveBaseline),a=i.length>1?"rgba(156, 39, 176, 0.4)":"rgba(61, 90, 254, 0.4)",r=i.length>1?"rgba(156, 39, 176, 0.05)":"rgba(61, 90, 254, 0.05)";n.addColorStop(0,a),n.addColorStop(1,r),t.fillStyle=n,t.fill(),t.beginPath(),t.moveTo(this.boxLeft,this.waveBaseline);for(let o=0;o<=e;o++){const d=o/e,c=this.boxLeft+d*s;let x=0,b=0;for(const m of i){const v=this.psi(m,d),p=this.energy(m);x+=l*v*Math.cos(p*this.time),b+=l*v*Math.sin(p*this.time)}const f=x*x+b*b,g=this.waveBaseline-f*h;t.lineTo(c,g)}t.strokeStyle=i.length>1?"#9c27b0":"#3d5afe",t.lineWidth=2.5,t.stroke()}else{t.beginPath();for(let n=0;n<=e;n++){const a=n/e,r=this.boxLeft+a*s;let o=0;for(const c of i)o+=l*this.psi(c,a)*Math.cos(this.energy(c)*this.time);const d=this.waveBaseline-o*h;n===0?t.moveTo(r,d):t.lineTo(r,d)}t.strokeStyle=i.length>1?"#9c27b0":"#3d5afe",t.lineWidth=2.5,t.stroke(),t.beginPath(),t.moveTo(this.boxLeft,this.waveBaseline);for(let n=0;n<=e;n++){const a=n/e,r=this.boxLeft+a*s;let o=0;for(const c of i)o+=l*this.psi(c,a)*Math.cos(this.energy(c)*this.time);const d=this.waveBaseline-o*h;t.lineTo(r,Math.min(d,this.waveBaseline))}t.lineTo(this.boxRight,this.waveBaseline),t.closePath(),t.fillStyle=i.length>1?"rgba(156, 39, 176, 0.12)":"rgba(61, 90, 254, 0.12)",t.fill(),t.beginPath(),t.moveTo(this.boxLeft,this.waveBaseline);for(let n=0;n<=e;n++){const a=n/e,r=this.boxLeft+a*s;let o=0;for(const c of i)o+=l*this.psi(c,a)*Math.cos(this.energy(c)*this.time);const d=this.waveBaseline-o*h;t.lineTo(r,Math.max(d,this.waveBaseline))}t.lineTo(this.boxRight,this.waveBaseline),t.closePath(),t.fillStyle="rgba(255, 64, 129, 0.12)",t.fill()}}loop(t){this.lastTimestamp||(this.lastTimestamp=t);const e=Math.min(t-this.lastTimestamp,100);this.lastTimestamp=t,this.update(e),this.draw(),requestAnimationFrame(this.loop)}}class B{canvas;ctx;width;height;activeStates=[1];maxN=8;constructor(t){this.canvas=t;const e=t.getContext("2d");if(!e)throw new Error("2D context not found");this.ctx=e,this.width=t.width,this.height=t.height,this.handleResize(),window.addEventListener("resize",()=>this.handleResize())}handleResize(){this.canvas.parentElement&&(this.canvas.width=this.canvas.parentElement.clientWidth,this.canvas.height=this.canvas.parentElement.clientHeight||200,this.width=this.canvas.width,this.height=this.canvas.height,this.draw())}getY(t){const e=t*t,h=this.maxN*this.maxN,s=e/h;return this.height-30-s*(this.height-60)}draw(){this.ctx.clearRect(0,0,this.width,this.height);const t=this.ctx,e=50,h=this.width-70;t.font="12px Arial",t.textAlign="right",t.textBaseline="middle";for(let s=1;s<=this.maxN;s++){const i=this.getY(s),l=this.activeStates.includes(s);t.beginPath(),t.strokeStyle=l?"#9c27b0":"#ddd",t.lineWidth=l?2.5:1,t.moveTo(e,i),t.lineTo(e+h,i),t.stroke(),t.fillStyle=l?"#9c27b0":"#999",t.font=l?"bold 12px Arial":"12px Arial",t.fillText(`n=${s}`,e-5,i),t.textAlign="left",t.fillText(`${s*s} E₁`,e+h+5,i),t.textAlign="right",l&&(t.beginPath(),t.fillStyle="#9c27b0",t.arc(e+h/2,i,6,0,Math.PI*2),t.fill())}}}document.addEventListener("DOMContentLoaded",()=>{const w=document.getElementById("pbox-canvas"),t=document.getElementById("energy-level-canvas");if(!w||!t)throw new Error("Canvas elements not found");const e=new u(w),h=new B(t),s=document.getElementById("quantum-n"),i=document.getElementById("quantum-n-val"),l=document.getElementById("display-mode"),n=document.getElementById("add-state"),a=document.getElementById("clear-states"),r=document.getElementById("states-list"),o=document.getElementById("toggle-animate"),d=document.getElementById("reset-animate"),c=document.getElementById("energy-val"),x=document.getElementById("nodes-val"),b=document.getElementById("wavelength-val"),f=()=>{const g=parseInt(s.value);e.previewN=g;const m=Array.from(new Set([...e.pinnedStates,e.previewN])).sort((p,y)=>p-y),v=m.length>1;e.showProbability=l.value==="probability",o.textContent=e.isAnimating?"Pause":"Animate Wavefunction",r.textContent=m.map(p=>`n=${p}${e.pinnedStates.includes(p)?"":" (preview)"}`).join(", "),i.textContent=`n = ${g}`,v?(c.textContent="Superposition",x.textContent="N/A",b.textContent="N/A"):(c.textContent=`${g*g} E₁`,x.textContent=`${g-1}`,g===1?b.textContent="2L":g===2?b.textContent="L":b.textContent=`2L/${g}`),h.activeStates=m,h.draw()};s.addEventListener("input",f),l.addEventListener("change",f),n.addEventListener("click",()=>{const g=parseInt(s.value);e.pinnedStates.includes(g)||(e.pinnedStates.push(g),e.pinnedStates.sort((m,v)=>m-v)),f()}),a.addEventListener("click",()=>{e.pinnedStates=[],f()}),o.addEventListener("click",()=>{e.isAnimating=!e.isAnimating,f()}),d.addEventListener("click",()=>{e.resetTime(),e.isAnimating=!1,f()}),f()});
