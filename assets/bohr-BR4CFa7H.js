import"./style-BgzER3dT.js";class E{canvas;ctx;width;height;n=3;targetN=null;transitionProgress=0;waitingForAbsorption=!1;electronAngle=0;electronSpeed=.035;photons=[];baseRadiusScale=30;constructor(t){this.canvas=t;const s=t.getContext("2d");if(!s)throw new Error("2D context not found");this.ctx=s,this.width=t.width,this.height=t.height,this.handleResize(),window.addEventListener("resize",()=>this.handleResize()),this.loop=this.loop.bind(this),requestAnimationFrame(this.loop)}handleResize(){this.canvas.parentElement&&(this.canvas.width=this.canvas.parentElement.clientWidth,this.canvas.height=this.canvas.parentElement.clientHeight,this.width=this.canvas.width,this.height=this.canvas.height,this.baseRadiusScale=Math.min(this.width,this.height)/20)}getRadius(t){return this.baseRadiusScale*(t*1.5)}transitionTo(t){this.targetN!==null||this.waitingForAbsorption||t!==this.n&&(this.targetN=t,t<this.n&&(this.emitPhoton(this.n,t),this.transitionProgress=0),t>this.n&&(this.absorbPhoton(this.n,t),this.waitingForAbsorption=!0,this.transitionProgress=0))}getPhotonColor(t,s){const i=Math.min(t,s),h=Math.max(t,s);return i===1?"#AA00FF":i===2?h===3?"#F44336":h===4?"#03A9F4":h===5?"#3F51B5":"#673AB7":i===3?"#D32F2F":"#FFFFFF"}absorbPhoton(t,s){const i=this.getPhotonColor(t,s),h=this.getRadius(t),o=Math.max(this.width,this.height)/1.5,e=3.5,a=(o-h)/e,g=.035/t,l=this.electronAngle+g*a,d=this.width/2+Math.cos(l)*o,u=this.height/2+Math.sin(l)*o,x=this.width/2+Math.cos(l)*h,c=this.height/2+Math.sin(l)*h,r=x-d,p=c-u,v=Math.sqrt(r*r+p*p);this.photons.push({x:d,y:u,vx:r/v*e,vy:p/v*e,color:i,life:1e3,totalLife:1e3,waviness:0,type:"absorption"})}emitPhoton(t,s){const i=this.getPhotonColor(t,s),h=this.getRadius(this.n),o=this.width/2+Math.cos(this.electronAngle)*h,e=this.height/2+Math.sin(this.electronAngle)*h,n=Math.atan2(e-this.height/2,o-this.width/2),a=3.5;this.photons.push({x:o,y:e,vx:Math.cos(n)*a,vy:Math.sin(n)*a,color:i,life:200,totalLife:200,waviness:0,type:"emission"})}update(){let t=this.n;if(this.targetN!==null&&!this.waitingForAbsorption){this.transitionProgress+=.015;const s=this.easeInOutQuad(this.transitionProgress);t=this.n+(this.targetN-this.n)*s,this.transitionProgress>=1&&(this.n=this.targetN,this.targetN=null,this.transitionProgress=0)}this.electronAngle+=.035/t;for(let s=this.photons.length-1;s>=0;s--){const i=this.photons[s];if(i.x+=i.vx,i.y+=i.vy,i.waviness+=.35,i.type==="emission")i.life--,i.life<=0&&this.photons.splice(s,1);else if(i.type==="absorption"){const h=i.x-this.width/2,o=i.y-this.height/2,e=Math.sqrt(h*h+o*o),n=this.getRadius(this.n);e<=n&&(this.waitingForAbsorption=!1,this.photons.splice(s,1))}}}draw(){this.ctx.clearRect(0,0,this.width,this.height);const t=this.width/2,s=this.height/2;for(let e=1;e<=6;e++){const n=this.getRadius(e);this.ctx.beginPath(),this.ctx.strokeStyle="rgba(0, 0, 0, 0.1)",(e===this.targetN||e===this.n)&&(this.ctx.strokeStyle="rgba(0, 0, 0, 0.3)"),this.waitingForAbsorption&&e===this.targetN&&(this.ctx.strokeStyle="rgba(0, 0, 0, 0.5)"),this.ctx.lineWidth=1,this.ctx.arc(t,s,n,0,Math.PI*2),this.ctx.stroke(),this.ctx.fillStyle="#666",this.ctx.font="10px Arial",this.ctx.fillText(`n=${e}`,t+5,s-n)}this.ctx.beginPath(),this.ctx.fillStyle="#ff1744",this.ctx.arc(t,s,6,0,Math.PI*2),this.ctx.fill(),this.ctx.shadowColor="#ff1744",this.ctx.shadowBlur=10;let i=this.getRadius(this.n);if(this.targetN!==null&&!this.waitingForAbsorption){const e=this.easeInOutQuad(this.transitionProgress),n=this.getRadius(this.n),a=this.getRadius(this.targetN);i=n+(a-n)*e}const h=t+Math.cos(this.electronAngle)*i,o=s+Math.sin(this.electronAngle)*i;this.ctx.beginPath(),this.ctx.fillStyle="#00e5ff",this.ctx.shadowColor="#00e5ff",this.ctx.shadowBlur=15,this.ctx.arc(h,o,5,0,Math.PI*2),this.ctx.fill(),this.ctx.shadowBlur=0,this.photons.forEach(e=>{this.ctx.beginPath(),this.ctx.strokeStyle=e.color,this.ctx.lineWidth=3,this.ctx.shadowColor=e.color,this.ctx.shadowBlur=8,this.ctx.lineCap="round";const n=Math.atan2(e.vy,e.vx),a=40,g=.4,l=6;this.ctx.save(),this.ctx.translate(e.x,e.y),this.ctx.rotate(n),this.ctx.moveTo(-a/2,0);for(let d=-a/2;d<=a/2;d+=2){const u=e.waviness,x=Math.abs(d),c=Math.max(0,1-x/(a/2)),r=Math.sin(d*g-u)*l*c;this.ctx.lineTo(d,r)}this.ctx.stroke(),this.ctx.restore(),this.ctx.shadowBlur=0})}loop(){this.update(),this.draw(),requestAnimationFrame(this.loop)}easeInOutQuad(t){return t<.5?2*t*t:-1+(4-2*t)*t}}class P{canvas;ctx;width;height;currentN=3;targetN=null;levels=[1,2,3,4,5,6];constructor(t){this.canvas=t;const s=t.getContext("2d");if(!s)throw new Error("2D context not found");this.ctx=s,this.width=t.width,this.height=t.height,this.handleResize(),window.addEventListener("resize",()=>this.handleResize())}handleResize(){this.canvas.parentElement&&(this.canvas.width=this.canvas.parentElement.clientWidth,this.canvas.height=this.canvas.parentElement.clientHeight||200,this.width=this.canvas.width,this.height=this.canvas.height,this.draw())}getY(t){const h=this.height-35-35,e=(-1/(t*t)- -1)/1,n=Math.sqrt(e);return this.height-35-n*h}updateState(t,s){this.currentN=t,this.targetN=s,this.draw()}draw(){this.ctx.clearRect(0,0,this.width,this.height);const t=this.ctx,s=55,i=this.width-80;this.levels.forEach(o=>{const e=this.getY(o),n=o===this.currentN,a=o===(this.targetN??-1);t.beginPath(),t.strokeStyle=n||a?"#340E51":"#bbb",t.lineWidth=n||a?2.5:1.2,t.moveTo(s,e),t.lineTo(s+i,e),t.stroke(),t.fillStyle=n||a?"#340E51":"#666",t.font=n||a?"bold 13px Lato, sans-serif":"12px Lato, sans-serif",t.textAlign="right",t.textBaseline="middle",t.fillText(`n=${o}`,s-8,e);const g=-13.6/(o*o);t.textAlign="left",t.fillText(`${g.toFixed(1)} eV`,s+i+8,e)});const h=this.getY(this.currentN);if(t.beginPath(),t.fillStyle="#2196F3",t.arc(s+i/2,h,7,0,Math.PI*2),t.fill(),t.beginPath(),t.strokeStyle="rgba(33,150,243,0.35)",t.lineWidth=3,t.arc(s+i/2,h,11,0,Math.PI*2),t.stroke(),this.targetN!==null){const o=this.getY(this.currentN),e=this.getY(this.targetN),n=s+i/2+25,g=this.targetN<this.currentN?"#E53935":"#43A047";t.beginPath(),t.strokeStyle=g,t.lineWidth=2.5,t.moveTo(n,o),t.lineTo(n,e),t.stroke();const l=8,d=e>o?1:-1;t.beginPath(),t.fillStyle=g,t.moveTo(n,e),t.lineTo(n-l*.6,e-d*l),t.lineTo(n+l*.6,e-d*l),t.closePath(),t.fill();const u=Math.abs(-13.6/(this.targetN*this.targetN)- -13.6/(this.currentN*this.currentN));t.fillStyle=g,t.font="bold 11px Lato, sans-serif",t.textAlign="left",t.textBaseline="middle",t.fillText(`${u.toFixed(2)} eV`,n+8,(o+e)/2)}t.fillStyle="#636e72",t.font="11px Lato, sans-serif",t.textAlign="center",t.textBaseline="top",t.fillText("E = −13.6 / n²  eV",this.width/2,5)}}document.addEventListener("DOMContentLoaded",()=>{const m=document.getElementById("bohr-canvas"),t=document.getElementById("energy-level-canvas");if(!m||!t)throw new Error("Canvas elements not found");const s=new E(m),i=new P(t),h=document.getElementById("initial-n"),o=document.getElementById("final-n"),e=document.getElementById("initial-n-val"),n=document.getElementById("final-n-val"),a=document.getElementById("transition-btn"),g=document.getElementById("delta-e"),l=document.getElementById("photon-wl"),d=document.getElementById("series-name"),u=(c,r)=>{const p=-13.6/(c*c),v=-13.6/(r*r),y=Math.abs(v-p),b=1240/y;let f="Unknown";const w=Math.min(c,r);w===1?f="Lyman (UV)":w===2?f="Balmer (Visible)":w===3?f="Paschen (IR)":w===4?f="Brackett (IR)":w===5&&(f="Pfund (IR)"),g&&(g.textContent=`${y.toFixed(2)} eV`),l&&(l.textContent=`${b.toFixed(0)} nm`),d&&(d.textContent=f)},x=()=>{const c=parseInt(h.value),r=parseInt(o.value);e&&(e.textContent=`n = ${c}`),n&&(n.textContent=`n = ${r}`),u(c,r),c===r?(a.disabled=!0,a.style.opacity="0.5",a.textContent="Same Level"):(a.disabled=!1,a.style.opacity="1",a.textContent=c>r?"Emit Photon":"Absorb Photon")};s.n=parseInt(h.value),i.currentN=parseInt(h.value),i.draw(),h.addEventListener("input",()=>{x();const c=parseInt(h.value);s.n=c,i.currentN=c,i.draw()}),o.addEventListener("input",x),a.addEventListener("click",()=>{const c=parseInt(h.value),r=parseInt(o.value);c!==r&&(s.transitionTo(r),i.targetN=r,i.draw(),u(c,r),setTimeout(()=>{h.value=r.toString(),x(),i.currentN=r,i.targetN=null,i.draw()},2e3))}),x()});
